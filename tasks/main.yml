---
- include: "sanity-checks.yml"

# Previous versions of this role defined jenkins_url as a default variable, but this URL
# did not include the port, and required the user to hard-code the protocol.
- name: Set jenkins_url fact for backwards-compatibility installations
  set_fact:
    jenkins_url: "{{ jenkins_url }}:{{ jenkins_port }}"
  when: jenkins_url is defined

- name: Set jenkins_url fact for HTTP
  set_fact:
    jenkins_url: "http://{{ jenkins_hostname }}:{{ jenkins_port }}"

- include: "{{ jenkins_install_via }}/install.yml"

- include: "configure-config.yml"
  when: jenkins_install_via != "docker"

- include: "configure-jenkins.yml"

- include: "configure-files.yml"
  when: jenkins_include_custom_files

- include: "configure-plugins.yml"

- include: "configure-jobs.yml"

- include: "{{ jenkins_after_config_jobs_file }}"
  when: jenkins_after_config_jobs_file

- include: "start.yml"

- include: "cancel-quiet-mode.yml"
